// src/utils/quickReplies.js
const logger = require('./logger');

// Ğ•Ğ´Ğ¸Ğ½Ğ°Ñ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ñ Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ±Ñ‹ÑÑ‚Ñ€Ñ‹Ñ… Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¾Ğ²
function generateUnifiedQuickReplies(aiResponse, userMessage = '', conversation = [], mode = 'chat') {
    const lowerResponse = aiResponse.toLowerCase();
    const lowerUser = userMessage.toLowerCase();
    
    // Ğ ĞµĞ¶Ğ¸Ğ¼ Ñ„Ğ¾Ñ€Ğ¼ÑƒĞ»Ğ¸Ñ€Ğ¾Ğ²ĞºĞ¸ - ÑƒĞ¿Ñ€Ğ¾Ñ‰ĞµĞ½Ğ½Ñ‹Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
    if (mode === 'formulation') {
        // Ğ•ÑĞ»Ğ¸ AI ÑĞ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµÑ‚ Ğ¾ Ñ‚Ğ¸Ğ¿Ğµ Ğ±Ğ¸Ğ·Ğ½ĞµÑĞ°
        if (lowerResponse.includes('Ğ±Ğ¸Ğ·Ğ½ĞµÑ') || lowerResponse.includes('Ğ·Ğ°Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ĞµÑÑŒ')) {
            return [];  // ĞŸÑƒÑÑ‚ÑŒ Ğ¿Ğ¸ÑˆÑƒÑ‚ ÑĞ²Ğ¾Ğ¸Ğ¼Ğ¸ ÑĞ»Ğ¾Ğ²Ğ°Ğ¼Ğ¸
        }
        
        // Ğ•ÑĞ»Ğ¸ AI Ğ³Ğ¾Ñ‚Ğ¾Ğ² ÑĞ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¢Ğ—
        if (lowerResponse.includes('Ğ³Ğ¾Ñ‚Ğ¾Ğ²') || lowerResponse.includes('ÑĞ¾Ğ·Ğ´Ğ°Ğ¼') || lowerResponse.includes('Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°Ñ')) {
            return [
                'âœ… Ğ”Ğ°, Ğ²ÑÑ‘ Ğ²ĞµÑ€Ğ½Ğ¾',
                'ğŸ“ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸',
                'ğŸ“‹ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ğµ Ğ¢Ğ—',
                'ğŸ’° Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ'
            ];
        }
        
        // Ğ•ÑĞ»Ğ¸ AI ÑƒÑ‚Ğ¾Ñ‡Ğ½ÑĞµÑ‚ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸
        if (lowerResponse.includes('ÑƒÑ‚Ğ¾Ñ‡Ğ½') || lowerResponse.includes('ĞºĞ°ĞºĞ¸Ğµ')) {
            return [
                'ğŸ’¬ ĞÑ‚Ğ²ĞµÑ‡Ñƒ Ñ‚ĞµĞºÑÑ‚Ğ¾Ğ¼',
                'ğŸ¤ Ğ—Ğ°Ğ¿Ğ¸ÑˆÑƒ Ğ³Ğ¾Ğ»Ğ¾ÑĞ¾Ğ¼',
                'ğŸ“‹ Ğ”Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¸Ğ½Ñ„Ğ¾, ÑĞ¾Ğ·Ğ´Ğ°Ğ¹Ñ‚Ğµ Ğ¢Ğ—'
            ];
        }
        
        return [];
    }
    
    // ĞĞ±Ñ‹Ñ‡Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ñ‡Ğ°Ñ‚Ğ° - Ğ¿Ğ¾Ğ»Ğ½Ğ°Ñ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ°
    
    // Ğ•ÑĞ»Ğ¸ ÑĞ¾Ğ±Ñ€Ğ°Ğ½Ğ¾ Ğ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ - Ğ¿Ñ€ĞµĞ´Ğ»Ğ°Ğ³Ğ°ĞµĞ¼ Ñ€Ğ°ÑÑ‡ĞµÑ‚
    if (lowerResponse.includes('ĞºĞ°ĞºĞ¸Ğµ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸') || 
        lowerResponse.includes('Ñ‡Ñ‚Ğ¾ ĞµÑ‰Ğµ') ||
        lowerResponse.includes('Ğ´Ğ¾Ğ¿Ğ¾Ğ»Ğ½Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾') ||
        lowerResponse.includes('Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¸') ||
        (lowerResponse.includes('Ğ±Ğ¾Ñ‚') && lowerResponse.includes('Ğ½ÑƒĞ¶ĞµĞ½'))) {
        return [
            "ğŸ’° ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ",
            "â• Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸",
            "ğŸ”„ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ",
            "â“ Ğ—Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ"
        ];
    }

    if (lowerResponse.includes('Ğ±Ğ¸Ğ·Ğ½ĞµÑ') || lowerResponse.includes('ĞºĞ¾Ğ¼Ğ¿Ğ°Ğ½')) {
        return [
            "ğŸ›’ Ğ˜Ğ½Ñ‚ĞµÑ€Ğ½ĞµÑ‚-Ğ¼Ğ°Ğ³Ğ°Ğ·Ğ¸Ğ½",
            "ğŸ“ ĞĞ±Ñ€Ğ°Ğ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ", 
            "ğŸ”§ Ğ£ÑĞ»ÑƒĞ³Ğ¸",
            "ğŸ  ĞĞµĞ´Ğ²Ğ¸Ğ¶Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ",
            "ğŸ’¼ Ğ”Ñ€ÑƒĞ³Ğ¾Ğµ"
        ];
    }

    if (lowerResponse.includes('Ğ·Ğ°Ğ´Ğ°Ñ‡') || lowerResponse.includes('Ñ„ÑƒĞ½ĞºÑ†')) {
        return [
            "ğŸ“ ĞÑ‚Ğ²ĞµÑ‡Ğ°Ñ‚ÑŒ Ğ½Ğ° Ğ²Ğ¾Ğ¿Ñ€Ğ¾ÑÑ‹",
            "ğŸ›’ ĞŸÑ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹", 
            "ğŸ“ Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ Ğ·Ğ°ÑĞ²ĞºĞ¸",
            "ğŸ“… Ğ—Ğ°Ğ¿Ğ¸ÑÑ‹Ğ²Ğ°Ñ‚ÑŒ Ğ½Ğ° ÑƒÑĞ»ÑƒĞ³Ğ¸",
            "ğŸ’° ĞŸÑ€Ğ¾Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹"
        ];
    }

    if (lowerResponse.includes('Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†') || lowerResponse.includes('Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡')) {
        return [
            "âœ… ĞÑƒĞ¶Ğ½Ğ° CRM",
            "ğŸ’³ ĞÑƒĞ¶Ğ½Ğ° Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°",
            "ğŸ“§ ĞÑƒĞ¶Ğ½Ğ° Ğ¿Ğ¾Ñ‡Ñ‚Ğ°", 
            "âŒ ĞŸĞ¾ĞºĞ° Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾"
        ];
    }

    if (lowerResponse.includes('Ğ³Ğ¾Ñ‚Ğ¾Ğ²') || lowerResponse.includes('ÑÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ€')) {
        return [
            "ğŸ“‹ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¢Ğ— ÑĞµĞ¹Ñ‡Ğ°Ñ",
            "ğŸ’¡ Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ñ„ÑƒĞ½ĞºÑ†Ğ¸Ğ¸",
            "ğŸ”„ Ğ˜Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ"
        ];
    }

    // ĞĞ±Ñ‰Ğ¸Ğµ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸ ĞµÑĞ»Ğ¸ Ğ½Ğ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ¾ÑˆĞ»Ğ¾
    if (conversation.length >= 3) {
        return [
            "ğŸ’° Ğ£Ğ·Ğ½Ğ°Ñ‚ÑŒ ÑÑ‚Ğ¾Ğ¸Ğ¼Ğ¾ÑÑ‚ÑŒ",
            "ğŸ“‹ Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¢Ğ—",
            "â“ Ğ—Ğ°Ğ´Ğ°Ñ‚ÑŒ Ğ²Ğ¾Ğ¿Ñ€Ğ¾Ñ"
        ];
    }

    return [];
}

module.exports = {
    generateUnifiedQuickReplies
};