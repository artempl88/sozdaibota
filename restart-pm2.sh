#!/bin/bash

echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2..."
echo "=========================="

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ PM2
if ! command -v pm2 &> /dev/null; then
    echo "‚ùå PM2 –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω"
    echo "üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: npm install -g pm2"
    exit 1
fi

# –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
echo "üìã –¢–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:"
pm2 list

echo ""
echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–ª–∏ –∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
if pm2 list | grep -q "sozdaibota"; then
    echo "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞..."
    pm2 restart sozdaibota
else
    echo "üöÄ –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2..."
    pm2 start start.js --name sozdaibota
fi

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
pm2 save

echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:"
pm2 status

echo ""
echo "üìã –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã PM2:"
echo "  pm2 logs sozdaibota    # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
echo "  pm2 status             # –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
echo "  pm2 restart sozdaibota # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫"
echo "  pm2 stop sozdaibota    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞"
echo "  pm2 delete sozdaibota  # –£–¥–∞–ª–µ–Ω–∏–µ"

echo ""
echo "‚úÖ –ì–æ—Ç–æ–≤–æ! –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —á–µ—Ä–µ–∑ PM2" 